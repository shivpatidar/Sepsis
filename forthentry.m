function [scores,labels]= forthentry(input_file,detectionmodel,earlypredictmodel,scorecombiner)
%UNTITLED Summary of this function goes here
%   Detailed explanation goes here

% load detectionmodel
% load earlypredictmodel
% load scorecombiner
Ta = ReadChallengeData(input_file);
data1=Ta(:,1:40); 

%normalization
mu1=[84.2624120046952,97.1761328114416,36.9662595084692,123.652520188669,82.4129909313104,63.9398496190287,18.6253282734301,32.9845716032832,-0.757963929029738,24.0881598859717,0.563428728465225,7.37772026969787,41.0467592529710,92.5488758417867,247.818013292942,23.2662874327052,102.096297142857,7.61000556146014,105.815950620501,1.50126210507736,1.58910384615382,136.855547927494,2.64837019892775,2.04439108378879,3.53780092338132,4.14065577605364,1.92349197834887,8.10312040904483,30.8768697608185,10.4595446019883,41.0444554775770,11.3449719810887,287.340115882754,197.052295285360,61.9788584913401,0.556252823722967,0.495656721455370,0.504343278544630,-53.5881013178857,23.4810565483379];
stdd1=[17.1806077973084,2.93400850253403,0.757511982748376,23.1265483362920,16.3667575504099,13.9861069681319,5.00601893238829,8.11054190247658,4.27158815001326,4.33129186659456,12.3143928901967,0.0737067700018948,9.23308415481263,11.0306694205014,824.713698095499,19.5217173892477,123.042353743209,2.38367622934364,5.82731074298518,1.82861570591461,3.18127304647286,51.7410493781832,2.57386301958978,0.396591127320778,1.41424824779430,0.644492032135537,3.95338228054520,24.5947801133075,5.51494621794335,1.97876477377512,26.1457530176896,7.72596932140035,148.686721523020,102.543353828508,16.4121454933982,0.496825719109664,0.499981423543595,0.499981423543595,153.938310147105,21.7567451055362];
data2=processdata(data1,mu1,stdd1);
[labels1,scores11]=predict(detectionmodel,data2);
scores1=scores11(:,2)./(sum(scores11(:,2)));


mu2=[88.0164239847772,97.2956393513063,37.1091699545275,124.276571989322,81.9690434889545,62.7217126766348,19.8068559204048,32.8182842336507,-0.278668314846987,23.9564238615289,0.521495356802304,7.38517059106200,41.0030172413794,93.3270515790755,347.938846051582,29.5128801826350,105.891223404255,7.11621022956101,105.856011183597,1.62457615256758,3.38991701244813,137.740130343936,2.65288347670650,2.10141772151899,3.59870358163041,4.10414876629062,3.53022790267940,10.6006715063521,30.0544863947639,10.1718927241478,42.8968917470525,12.4524260834345,294.690179087233,186.263038911217,62.2847918394968,0.589397027802138,0.518407539276859,0.481592460723141,-80.3687560142738,61.5212663838259];
stdd2=[18.4731051165213,3.01241098074589,0.896177444114061,24.3275962713333,16.1716530320436,13.6913636090219,5.86863564853400,7.51026331313006,4.47671588584608,4.69721811378538,0.353619569376497,0.0808973196888907,9.73883468162124,9.83014788556610,1042.41080948314,22.8970298689495,96.1868477817303,2.78339867782500,6.22635923941075,1.61114882477094,5.68005739127261,47.6838082873252,2.40463460045973,0.404111217160038,1.48989839999579,0.636810032289462,6.20656281240651,27.6311270510266,5.24367323469478,1.86395211507947,27.0086487818308,7.90631567155536,181.424814007341,113.413500800018,16.1574304457507,0.491944717861839,0.499663983329487,0.499663983329487,223.293987156925,56.5677315616472];
data3=processdata(data1,mu2,stdd2);
[labels2,scores22]=predict(earlypredictmodel,data3);
scores2=scores22(:,2)./(sum(scores22(:,2)));
[labels,scores]=predict(scorecombiner,[scores1,scores2]);

% tt=[scores(:,2) labels ];
% header1 = 'PredictedProbability';
% header2 = 'PredictedLabel';
% fileID = fopen([recbase '*.psv'], 'w');
% fprintf(fileID, [ header1 '|' header2 '\n']);
% fprintf(fileID, ['%.3f|%.3f' '\n'],tt');
% fclose(fileID);


end

function [values, column_names] = ReadChallengeData(filename)
  f = fopen(filename, 'rt');
  try
    l = fgetl(f);
    column_names = strsplit(l, '|');
    values = dlmread(filename, '|', 1, 0);
  catch ex
    fclose(f);
    rethrow(ex);
  end
  fclose(f);

  %% ignore SepsisLabel column if present
  if strcmp(column_names(end), 'SepsisLabel')
    column_names = column_names(1:end-1);
    values = values(:,1:end-1);
  end
end




